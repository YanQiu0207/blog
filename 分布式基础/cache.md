# 缓存（Cache）

## 缓存的作用

缓存是一个临时存储区域，保存了昂贵响应的结果或者频繁访问的数据，以便于后续的读取请求能够更快地被响应。核心是以空间换时间

## 适用场景

读多写少

## 缓存模式

（1）Cache Aside

（2）Write Through

实现：

* 所有写操作

优点：

* 数据被同时写入缓存和存储系统，减少了数据丢失的风险

缺点：

* 影响写操作的性能

（3）Write Behind

实现：

* 当数据被写入缓存时，就给客户端返回成功
* 数据在后台异步写入存储系统，例如定期更新或者数据卸载时

优点：

* 提高了写操作的性能

缺点：

* 增加了数据丢失的风险。如果缓存在数据持久化前就宕机了，数据就丢失了

## 过期策略

如果数据长期未被使用，需要从缓存中删除，否则会一直占用内存。如果缓存时间过短，会频繁读取存储系统，导致性能下降。如果缓存时间过长，读取的数据很可能已经过期

## 淘汰策略

通常，缓存的数据量量应该设置一个上限，以避免内存无限上涨，导致宕机。当缓存已满时，如果想增加一个新数据，需要先淘汰一个旧数据，这被叫作**缓存淘汰**。常见的缓存淘汰策略有：

（1）最近最少使用（Least-recently-used）：优先淘汰上次读取时间距离当前时间最久的数据

实现，优缺点，使用场景

（2）最不经常使用（Least-frequently-used）：优先淘汰访问频次最低的数据

（3）先进先出（FIFO）：优先淘汰最先加入缓存的数据

（4）随机删除（Random）：随机选择一个数据删除

## 一致性

存储系统和缓存数据要保持一致。如果对这两个地方的数据修改操作不是在一个事务内同时完成的话，可能导致数据不一致。

## 故障处理

（1）为了避免缓存成为系统中的单点，需要在多个数据中心部署缓存服务器
（2）按一定百分比超额配置所需的内存。这在内存使用增加时提供了一个缓冲区

## 参考资料

* [数据库和缓存的一致性](https://danielw.cn/cache-consistency-with-database-cn)
* [缓存模式以及选择](https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/)
* [数据库和缓存的一致性](https://www.zhihu.com/zvideo/1608495870965657600)
* 极客时间 -- Redis课程
* 了解常见的缓存面试题