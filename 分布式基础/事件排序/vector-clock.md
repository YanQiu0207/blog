
## 为什么需要向量时钟

逻辑时钟算法提供了一种判断分布式系统中事件因果关系的方法：如果 a --> b，那么 C(a) < C(b)，但是 C(a) < C(b) 并不能说明 a --> b

逻辑时钟算法中每个进程只知道自己的时间，不知道其它进程的时间。如果知道，是否就可以判断事件的因果关系了呢？

## 向量时钟

每个进程发送消息时，除了带上自己的逻辑时间戳，还会将自己知道的其它所有进程的时间戳一起带上。这些时间组成了一个向量。

## 如何实现

假设分布式系统中有 N 个进程，每个进程都要一个本地向量时间戳 T，实现如下：

*   对于进程 i 来说，Ti[i] 是进程本地时间戳
*   当进程 i 有新事件发生时，Ti[i] = Ti[i] + 1
*   当进程发送消息时，它的向量时间戳 Ti 附带在消息中
*   接收消息的进程 j 更新本地的向量时间戳：Tj[k] = max(Tj[k], Ti[k]) for k in (1, N)；Tj[j] = Tj[j] + 1

假设有事件 a、b 分别在节点 P、Q 上发生，向量时钟分别为 Ta、Tb，

*   如果 Tb[Q] > Ta[Q] 并且 Tb[P] >= Ta[P]，则a发生于b之前，记作 a -> b，此时说明事件 a、b 有因果关系
*   反之，如果 Tb[Q] > Ta[Q] 并且 Tb[P] < Ta[P]，则认为a、b同时发生，记作 a <-> b。

## 核心

通过向量时间戳就能比较任意两个事件的因果关系：要么是先后关系，要么是同时发生关系

## 用途

（1）版本向量，检测数据冲突，学习 CRDT
